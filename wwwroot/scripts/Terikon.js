(function(){var e,t={}.hasOwnProperty,r=[].slice;null!=(null!=(e=this.google)?e.maps:void 0)&&(this.OverlappingMarkerSpiderfier=function(){function e(e,r){var n,s,l,o,h,a;this.map=e,null==r&&(r={});for(s in r)t.call(r,s)&&(a=r[s],this[s]=a);for(this.projHelper=new this.constructor.ProjHelper(this.map),this.initMarkerArrays(),this.listeners={},h=["click","zoom_changed","maptypeid_changed"],l=0,o=h.length;o>l;l++)n=h[l],i.addListener(this.map,n,function(e){return function(){return e.unspiderfy()}}(this)),i.addListener(this.map,n,function(e){return function(){return e.clearSpArrays()}}(this))}var i,n,s,l,o,h,a,u,p,g,f,c,d;for(p=e.prototype,g=[e,p],s=0,h=g.length;h>s;s++)d=g[s],d.VERSION="0.3.3";return n=google.maps,i=n.event,a=n.MapTypeId,c=2*Math.PI,f=[],u=[],p.keepSpiderfied=!1,p.markersWontHide=!1,p.markersWontMove=!1,p.nearbyDistance=20,p.circleSpiralSwitchover=9,p.circleFootSeparation=23,p.circleStartAngle=c/12,p.spiralFootSeparation=26,p.spiralLengthStart=11,p.spiralLengthFactor=4,p.spiderfiedZIndex=1e3,p.usualLegZIndex=10,p.highlightedLegZIndex=20,p.legWeight=1.5,p.legColors={usual:{},highlighted:{}},o=p.legColors.usual,l=p.legColors.highlighted,o[a.HYBRID]=o[a.SATELLITE]="#fff",l[a.HYBRID]=l[a.SATELLITE]="#f00",o[a.TERRAIN]=o[a.ROADMAP]="#444",l[a.TERRAIN]=l[a.ROADMAP]="#f00",p.initMarkerArrays=function(){return this.markers=[],this.markerListenerRefs=[]},p.clearSpArrays=function(){return f=[],u=[]},p.addMarker=function(e){var t;return null!=e._oms?this:(e._oms=!0,t=[i.addListener(e,"click",function(t){return function(r){return t.spiderListener(e,r)}}(this))],this.markersWontHide||t.push(i.addListener(e,"visible_changed",function(t){return function(){return t.markerChangeListener(e,!1)}}(this))),this.markersWontMove||t.push(i.addListener(e,"ghostposition_changed",function(t){return function(){return t.markerChangeListener(e,!0)}}(this))),this.markerListenerRefs.push(t),this.markers.push(e),this)},p.keepItSpiderfied=function(){return this.spiderfy(f,u)},p.markerChangeListener=function(e,t){return null==e._omsData||!t&&e.getVisible()||null!=this.spiderfying||null!=this.unspiderfying?void 0:this.unspiderfy(t?e:null)},p.getMarkers=function(){return this.markers.slice(0)},p.removeMarker=function(e){var t,r,n,s,l;if(null!=e._omsData&&this.unspiderfy(),t=this.arrIndexOf(this.markers,e),0>t)return this;for(l=this.markerListenerRefs.splice(t,1)[0],r=0,n=l.length;n>r;r++)s=l[r],i.removeListener(s);return delete e._oms,this.markers.splice(t,1),this},p.clearMarkers=function(){var e,t,r,n,s,l,o,h,a;for(this.unspiderfy(),a=this.markers,e=t=0,r=a.length;r>t;e=++t){for(o=a[e],l=this.markerListenerRefs[e],h=0,n=l.length;n>h;h++)s=l[h],i.removeListener(s);delete o._oms}return this.initMarkerArrays(),this},p.addListener=function(e,t){var r;return(null!=(r=this.listeners)[e]?r[e]:r[e]=[]).push(t),this},p.removeListener=function(e,t){var r;return r=this.arrIndexOf(this.listeners[e],t),0>r||this.listeners[e].splice(r,1),this},p.clearListeners=function(e){return this.listeners[e]=[],this},p.trigger=function(){var e,t,i,n,s,l,o,h;for(t=arguments[0],e=2<=arguments.length?r.call(arguments,1):[],o=null!=(l=this.listeners[t])?l:[],h=[],n=0,s=o.length;s>n;n++)i=o[n],h.push(i.apply(null,e));return h},p.generatePtsCircle=function(e,t){var r,i,s,l,o,h,a,u;for(s=this.circleFootSeparation*(2+e),h=s/c,i=c/e,u=[],l=o=0,a=e;a>=0?a>o:o>a;l=a>=0?++o:--o)r=this.circleStartAngle+l*i,u.push(new n.Point(t.x+h*Math.cos(r),t.y+h*Math.sin(r)));return u},p.generatePtsSpiral=function(e,t){var r,i,s,l,o,h,a;for(l=this.spiralLengthStart,r=0,a=[],i=s=0,h=e;h>=0?h>s:s>h;i=h>=0?++s:--s)r+=this.spiralFootSeparation/l+5e-4*i,o=new n.Point(t.x+l*Math.cos(r),t.y+l*Math.sin(r)),l+=c*this.spiralLengthFactor/r,a.push(o);return a},p.spiderListener=function(e,t){var r,i,n,s,l,o,h,a,u,p,g;if(o=null!=e._omsData,o&&this.keepSpiderfied||this.unspiderfy(),o||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",e,t);for(a=[],u=[],h=this.nearbyDistance,p=h*h,l=this.llToPt(e.getGhostPosition()),g=this.markers,r=0,i=g.length;i>r;r++)n=g[r],null!=n.map&&n.getVisible()&&(s=this.llToPt(n.getGhostPosition()),this.ptDistanceSq(s,l)<p?a.push({marker:n,markerPt:s}):u.push(n));return 1===a.length?this.trigger("click",e,t):this.spiderfy(a,u)},p.markersNearMarker=function(e,t){var r,i,n,s,l,o,h,a,u,p,g;if(null==t&&(t=!1),null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearMarker";for(h=this.nearbyDistance,a=h*h,l=this.llToPt(e.getGhostPosition()),o=[],u=this.markers,r=0,i=u.length;i>r&&(n=u[r],!(n!==e&&null!=n.map&&n.getVisible()&&(s=this.llToPt(null!=(p=null!=(g=n._omsData)?g.usualPosition:void 0)?p:n.getGhostPosition()),this.ptDistanceSq(s,l)<a&&(o.push(n),t))));r++);return o},p.markersNearAnyOtherMarker=function(){var e,t,r,i,n,s,l,o,h,a,u,p,g,f,c,d,m,k,y,v,L;if(null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";for(c=this.nearbyDistance,d=c*c,g=function(){var e,t,r,i,n,s;for(r=this.markers,s=[],e=0,t=r.length;t>e;e++)o=r[e],s.push({pt:this.llToPt(null!=(i=null!=(n=o._omsData)?n.usualPosition:void 0)?i:o.getGhostPosition()),willSpiderfy:!1});return s}.call(this),k=this.markers,t=i=0,n=k.length;n>i;t=++i)if(h=k[t],null!=h.map&&h.getVisible()&&(a=g[t],!a.willSpiderfy))for(y=this.markers,r=f=0,s=y.length;s>f;r=++f)if(u=y[r],r!==t&&null!=u.map&&u.getVisible()&&(p=g[r],(!(t>r)||p.willSpiderfy)&&this.ptDistanceSq(a.pt,p.pt)<d)){a.willSpiderfy=p.willSpiderfy=!0;break}for(v=this.markers,L=[],e=m=0,l=v.length;l>m;e=++m)o=v[e],g[e].willSpiderfy&&L.push(o);return L},p.makeHighlightListenerFuncs=function(e){return{highlight:function(t){return function(){return e._omsData.leg.setOptions({strokeColor:t.legColors.highlighted[t.map.mapTypeId],zIndex:t.highlightedLegZIndex})}}(this),unhighlight:function(t){return function(){return e._omsData.leg.setOptions({strokeColor:t.legColors.usual[t.map.mapTypeId],zIndex:t.usualLegZIndex})}}(this)}},p.spiderfy=function(e,t){var r,s,l,o,h,a,p,g,c,d,m;return this.spiderfying=!0,f=e.slice(),u=t.slice(),d=e.length,r=this.ptAverage(function(){var t,r,i;for(i=[],t=0,r=e.length;r>t;t++)g=e[t],i.push(g.markerPt);return i}()),o=d>=this.circleSpiralSwitchover?this.generatePtsSpiral(d,r).reverse():this.generatePtsCircle(d,r),m=function(){var t,r,u;for(u=[],t=0,r=o.length;r>t;t++)l=o[t],s=this.ptToLl(l),c=this.minExtract(e,function(e){return function(t){return e.ptDistanceSq(t.markerPt,l)}}(this)),p=c.marker,a=new n.Polyline({map:this.map,path:[p.getGhostPosition(),s],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),p._omsData={usualPosition:p.getGhostPosition(),leg:a},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(h=this.makeHighlightListenerFuncs(p),p._omsData.hightlightListeners={highlight:i.addListener(p,"mouseover",h.highlight),unhighlight:i.addListener(p,"mouseout",h.unhighlight)}),p.setGhostPosition(s),p.setZIndex(Math.round(this.spiderfiedZIndex+l.y)),u.push(p);return u}.call(this),delete this.spiderfying,this.spiderfied=!0,this.trigger("spiderfy",m,t)},p.unspiderfy=function(e){var t,r,n,s,l,o,h,a;if(null==e&&(e=null),null==this.spiderfied)return this;for(this.unspiderfying=!0,a=[],l=[],h=this.markers,t=0,r=h.length;r>t;t++)s=h[t],null!=s._omsData?(o=s._omsData.leg.getPath(),s!==e&&s.setGhostPosition(o.getArray()[0]),s._omsData.leg.setMap(null),s.setZIndex(null),n=s._omsData.hightlightListeners,null!=n&&(i.removeListener(n.highlight),i.removeListener(n.unhighlight)),delete s._omsData,a.push(s)):l.push(s);return delete this.unspiderfying,delete this.spiderfied,this.trigger("unspiderfy",a,l),this},p.ptDistanceSq=function(e,t){var r,i;return r=e.x-t.x,i=e.y-t.y,r*r+i*i},p.ptAverage=function(e){var t,r,i,s,l,o;for(l=o=0,t=0,r=e.length;r>t;t++)s=e[t],l+=s.x,o+=s.y;return i=e.length,new n.Point(l/i,o/i)},p.llToPt=function(e){return this.projHelper.getProjection().fromLatLngToDivPixel(e)},p.ptToLl=function(e){return this.projHelper.getProjection().fromDivPixelToLatLng(e)},p.minExtract=function(e,t){var r,i,n,s,l,o,h;for(n=l=0,o=e.length;o>l;n=++l)s=e[n],h=t(s),("undefined"==typeof r||null===r||i>h)&&(i=h,r=n);return e.splice(r,1)[0]},p.arrIndexOf=function(e,t){var r,i,n,s;if(null!=e.indexOf)return e.indexOf(t);for(r=i=0,n=e.length;n>i;r=++i)if(s=e[r],s===t)return r;return-1},e.ProjHelper=function(e){return this.setMap(e)},e.ProjHelper.prototype=new n.OverlayView,e.ProjHelper.prototype.draw=function(){},e}())}).call(this);